schema: '2.0'
stages:
  train_supervised@diffpool:
    cmd: PYTHONPATH=. python3 experiments/scripts/train_supervised.py --model-name
      diffpool --config-path experiments/configs/diffpool.yaml --checkpoint-dir data/supervised/diffpool/checkpoints
      --save-test-dir data/supervised/diffpool/submssion --metrics-path data/metrics/supervised/diffpool.json
      --log-dir data/supervised/diffpool/logs
    deps:
    - path: data/dataset/pcqm4m_kddcup2021/processed/
      md5: 64357964c6c6b0c952118406da05a266.dir
      size: 27244718339
      nfiles: 5
    params:
      experiments/configs/diffpool.yaml:
        args:
          graph_pooling: sum
          drop_ratio: 0
          num_layers: 5
          emb_dim: 150
        data_loader_args:
          batch_size: 256
        dataset: ogb.lsc.DglPCQM4MDataset
        learning_args:
          epochs: 1
        reg: torch.nn.L1Loss
        step_lr:
          step_size: 300
          gamma: 0.25
    outs:
    - path: data/metrics/supervised/diffpool.json
      md5: c361b3354378b48868aa97469ed3e894
      size: 148
    - path: data/supervised/diffpool/
      md5: 60eb5701d23402f13a034c081aa94299.dir
      size: 7805827
      nfiles: 3
  preprocess_dataset@PygPCQM4MDataset:
    cmd: PYTHONPATH=. python3 experiments/scripts/preprocess_dataset.py --dataset
      PygPCQM4MDataset
    deps:
    - path: experiments/scripts/preprocess_dataset.py
      md5: a7e91630d52a9e4f4e906f983daa0cf9
      size: 741
    - path: params.yaml
      md5: b82edea341646bf25fd546adde5813c0
      size: 626
    outs:
    - path: data/dataset/pcqm4m_kddcup2021/processed/geometric_data_processed.pt
      md5: d3d5134387a081ede17855f5d0d812c4
      size: 8451179131
  preprocess_dataset@LinearPCQM4MDataset:
    cmd: PYTHONPATH=. python3 experiments/scripts/preprocess_dataset.py --dataset
      LinearPCQM4MDataset
    deps:
    - path: experiments/scripts/preprocess_dataset.py
      md5: a7e91630d52a9e4f4e906f983daa0cf9
      size: 741
    - path: params.yaml
      md5: b82edea341646bf25fd546adde5813c0
      size: 626
    outs:
    - path: data/dataset/pcqm4m_kddcup2021/processed/graph_ft.pt
      md5: 08245ed3273583de3ab362b702ad4d35
      size: 319491073
  preprocess_dataset@DglPCQM4MDataset:
    cmd: PYTHONPATH=. python3 experiments/scripts/preprocess_dataset.py --dataset
      DglPCQM4MDataset
    deps:
    - path: experiments/scripts/preprocess_dataset.py
      md5: a7e91630d52a9e4f4e906f983daa0cf9
      size: 741
    - path: params.yaml
      md5: b82edea341646bf25fd546adde5813c0
      size: 626
    outs:
    - path: data/dataset/pcqm4m_kddcup2021/processed/dgl_data_processed
      md5: bb048e32b9e0e2685c66111af087662c
      size: 11577611202
  train_supervised@gin-virtual:
    cmd: PYTHONPATH=. python3 experiments/scripts/train_supervised.py --model-name
      gin-virtual --config-path experiments/configs/gin-virtual.yaml --checkpoint-dir
      data/supervised/gin-virtual/checkpoints --save-test-dir data/supervised/gin-virtual/submssion
      --metrics-path data/metrics/supervised/gin-virtual/ --log-dir data/supervised/gin-virtual/logs
    deps:
    - path: data/dataset/pcqm4m_kddcup2021/processed/
      md5: e814a1e139a7b201e836ddc3575b32ef.dir
      size: 20348281406
      nfiles: 3
    params:
      experiments/configs/gin-virtual.yaml:
        args:
          graph_pooling: sum
          drop_ratio: 0
          num_layers: 5
          emb_dim: 600
        data_loader_args:
          batch_size: 1024
        dataset: ogb.lsc.PygPCQM4MDataset
        learning_args:
          epochs: 30
        reg: torch.nn.L1Loss
        step_lr:
          step_size: 300
          gamma: 0.25
    outs:
    - path: data/metrics/supervised/gin-virtual/all.json
      md5: 4e5ad992eddbcd86ff72a5897b7ae164
      size: 1465
    - path: data/supervised/gin-virtual/
      md5: 576852bdcff51916122230d0682061eb.dir
      size: 244131988
      nfiles: 9
  train_supervised@gin-virtual-diffpool:
    cmd: PYTHONPATH=. python3 experiments/scripts/train_supervised.py --model-name
      gin-virtual-diffpool --config-path experiments/configs/gin-virtual-diffpool.yaml
      --checkpoint-dir data/supervised/gin-virtual-diffpool/checkpoints --save-test-dir
      data/supervised/gin-virtual-diffpool/submssion --metrics-path data/metrics/supervised/gin-virtual-diffpool/
      --log-dir data/supervised/gin-virtual-diffpool/logs
    deps:
    - path: data/dataset/pcqm4m_kddcup2021/processed/
      md5: e814a1e139a7b201e836ddc3575b32ef.dir
      size: 20348281406
      nfiles: 3
    params:
      experiments/configs/gin-virtual-diffpool.yaml:
        args:
          graph_pooling: sum
          drop_ratio: 0
          num_layers: 5
          emb_dim: 600
        data_loader_args:
          batch_size: 512
        dataset: ogb.lsc.DglPCQM4MDataset
        learning_args:
          epochs: 30
        reg: torch.nn.L1Loss
        step_lr:
          step_size: 300
          gamma: 0.25
    outs:
    - path: data/metrics/supervised/gin-virtual-diffpool/all.json
      md5: f49f081cb1b774a019ab16bb5dfc05a4
      size: 1464
    - path: data/supervised/gin-virtual-diffpool/
      md5: 6571d8865743108981b2a69b9bd2061e.dir
      size: 283309867
      nfiles: 9
  make_predictions:
    cmd: PYTHONPATH=. python3 experiments/scripts/make_predictions.py --config-path
      experiments/configs/make_predictions.yaml
    deps:
    - path: experiments/configs/make_predictions.yaml
      md5: 79f9e0661b494827a360b8427eb52a0b
      size: 1188
    - path: experiments/scripts/make_predictions.py
      md5: d86169bce1ac9538427a9ed66282acaf
      size: 3254
    outs:
    - path: data/predictions/predictions.pkl
      md5: ad242590687590cb0b59c8018540dec8
      size: 182577245
  get_representations:
    cmd: PYTHONPATH=. python3 experiments/scripts/get_representations.py --config-path
      experiments/configs/make_predictions.yaml
    deps:
    - path: data/supervised
      md5: 48da974467fae2281bc6b2bed46540dc.dir
      size: 777248886
      nfiles: 28
    - path: experiments/configs/make_predictions.yaml
      md5: 79f9e0661b494827a360b8427eb52a0b
      size: 1188
    - path: experiments/scripts/make_predictions.py
      md5: d86169bce1ac9538427a9ed66282acaf
      size: 3254
    outs:
    - path: data/predictions/error_group_split_idx.pkl
      md5: 305f1ff1bedb706b59744b414571a3d3
      size: 112226
    - path: data/predictions/error_group_split_idx_groups_mapping.pkl
      md5: 2b9386850e9b60d280fb34a726ce76e6
      size: 497473
    - path: data/predictions/representations.pkl
      md5: 4d16932316e7af868c80476a2a7c7e49
      size: 302403931
  train_supervised@gin-virtual-bnn:
    cmd: PYTHONPATH=. python3 experiments/scripts/train_supervised.py --model-name
      gin-virtual-bnn --config-path experiments/configs/gin-virtual-bnn.yaml --checkpoint-dir
      data/supervised/gin-virtual-bnn/checkpoints --save-test-dir data/supervised/gin-virtual-bnn/submssion
      --metrics-path data/metrics/supervised/gin-virtual-bnn/ --log-dir data/supervised/gin-virtual-bnn/logs
    deps:
    - path: data/dataset/pcqm4m_kddcup2021/processed/
      md5: e814a1e139a7b201e836ddc3575b32ef.dir
      size: 20348281406
      nfiles: 3
    params:
      experiments/configs/gin-virtual-bnn.yaml:
        args:
          graph_pooling: sum
          drop_ratio: 0
          num_layers: 5
          emb_dim: 600
        data_loader_args:
          batch_size: 1024
        dataset: ogb.lsc.PygPCQM4MDataset
        learning_args:
          epochs: 30
        reg: torch.nn.L1Loss
        step_lr:
          step_size: 300
          gamma: 0.25
    outs:
    - path: data/metrics/supervised/gin-virtual-bnn/all.json
      md5: 7c2d8d4e96176eec8168ed26eed07eac
      size: 1465
    - path: data/supervised/gin-virtual-bnn/
      md5: 4531909134901612d346efc1545a6e72.dir
      size: 249806979
      nfiles: 9
  train_supervised_error_group@gin-virtual:
    cmd: PYTHONPATH=. python3 experiments/scripts/train_supervised.py --model-name
      gin-virtual --config-path experiments/configs/gin-virtual.yaml --checkpoint-dir
      data/supervised_error_group/gin-virtual/checkpoints --save-test-dir data/supervised_error_group/gin-virtual/submssion
      --metrics-path data/metrics/supervised_error_group/gin-virtual/ --log-dir data/supervised_error_group/gin-virtual/logs
      --split-idx-path data/dataset/pcqm4m_kddcup2021/most_error_group_split_idx.pt
    deps:
    - path: data/dataset/pcqm4m_kddcup2021/processed/
      md5: e814a1e139a7b201e836ddc3575b32ef.dir
      size: 20348281406
      nfiles: 3
    params:
      experiments/configs/gin-virtual.yaml:
        args:
          graph_pooling: sum
          drop_ratio: 0
          num_layers: 5
          emb_dim: 600
        data_loader_args:
          batch_size: 1024
        dataset: ogb.lsc.PygPCQM4MDataset
        learning_args:
          epochs: 30
        reg: torch.nn.L1Loss
        step_lr:
          step_size: 300
          gamma: 0.25
    outs:
    - path: data/metrics/supervised_error_group/gin-virtual/all.json
      md5: 1e364a5ede89c60f22b3ab8f21621acb
      size: 1458
    - path: data/supervised_error_group/gin-virtual/
      md5: dd0eb00f066dff7becf928788db7900f.dir
      size: 244125228
      nfiles: 9
  train_supervised_least_error_group@gin-virtual:
    cmd: PYTHONPATH=. python3 experiments/scripts/train_supervised.py --model-name
      gin-virtual --config-path experiments/configs/gin-virtual.yaml --checkpoint-dir
      data/supervised_error_group_least/gin-virtual/checkpoints --save-test-dir data/supervised_error_group_least/gin-virtual/submssion
      --metrics-path data/metrics/supervised_error_group_least/gin-virtual/ --log-dir
      data/supervised_error_group_least/gin-virtual/logs --split-idx-path data/dataset/pcqm4m_kddcup2021/least_undersampled_error_group_split_idx.pt
    deps:
    - path: data/dataset/pcqm4m_kddcup2021/processed/
      md5: e814a1e139a7b201e836ddc3575b32ef.dir
      size: 20348281406
      nfiles: 3
    params:
      experiments/configs/gin-virtual.yaml:
        args:
          graph_pooling: sum
          drop_ratio: 0
          num_layers: 5
          emb_dim: 600
        data_loader_args:
          batch_size: 1024
        dataset: ogb.lsc.PygPCQM4MDataset
        learning_args:
          epochs: 30
        reg: torch.nn.L1Loss
        step_lr:
          step_size: 300
          gamma: 0.25
    outs:
    - path: data/metrics/supervised_error_group_least/gin-virtual/all.json
      md5: 8fad85a0b0504bf574a9d8ee77d5fabb
      size: 1462
    - path: data/supervised_error_group_least/gin-virtual/
      md5: 17cfb8277700c00dd487ebf1febc3fc6.dir
      size: 244120468
      nfiles: 9
